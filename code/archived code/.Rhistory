(ContraCostadflist[[121]][1,])
(ContraCostadflist[[121]][1,1])
(ContraCostadflist[[11]][1,1])
(ContraCostadflist[[10]][1,1])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,5,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["NA"]])
View(ContraCostadflist[["NA"]])
ContraCostadflist=combinedContraCosta
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["Sheet1"]])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,5,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["Contra Costa County"]])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["MEASURE P - CITY OF RICHMOND -
MAJORITY   **** - Insufficient Turnout to Protect Voter Privacy"]])
names(ContraCostadflist[[121]])
names(ContraCostadflist[121])
source("~/Library/CloudStorage/Dropbox/niskanen/code/Statement of Votes Data Organizer.R", echo=TRUE)
aths
AlamedaFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Alameda County SVC Reformatted.xlsx"
ContraCostaFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Contra Costa County SVC Reformatted.xlsx"
FresnoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Fresno County SVC Reformatted.xlsx"
LosAngelesFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Los Angeles County SVC Reformatted.xlsx"
OrangeFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Orange County SVC Reformatted.xlsx"
SacramentoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Sacramento County SVC Reformatted.xlsx"
SanBenitoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/San Benito County SVC Reformatted.xlsx"
SanBernardinoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/San Bernardino County SVC Reformatted.xlsx"
SanFranciscoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/San Francisco County SVC Reformatted.xlsx"
SanMateoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/San Mateo County SVC Reformatted.xlsx"
SantaCruzFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Santa Cruz County SVC Reformatted.xlsx"
SolanoFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Solano County SVC Reformatted.xlsx"
StanislausFilePath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statement of Votes—Intermediate Reformatting/Stanislaus County SVC Reformatted.xlsx"
combinedContraCosta=combinesheets(ContraCostaFilePath)
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["MEASURE P - CITY OF RICHMOND -
MAJORITY"]])
View(ContraCostadflist[["UNITED STATES SENATOR"]])
ContraCostadflist=combinedContraCosta
###############################################################################################################################
View(ContraCostadflist)
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["Sheet121"]])
names(ContraCostadflist[121])='hi'
View(ContraCostadflist[["Sheet121"]])
names(ContraCostadflist[121])
names(ContraCostadflist[121])='hi'
names(ContraCostadflist[121])
names(ContraCostadflist[121])<-'hi'
names(ContraCostadflist[121])
names(ContraCostadflist[11])='hi'
names(ContraCostadflist[11])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
#transform to CSV
ContraCostacsvoutput=transform_to_csv(ContraCostadflist,'Precinct')
#transform to CSV
Alamedacsvoutput=(transform_to_csv(Alamedadflist,'PRECINCT'))
###############################################################################################################################
View(ContraCostacsvoutput)
View(ContraCostadflist[["UNITED STATES SENATOR"]])
View(ContraCostadflist[["MEASURE P - CITY OF RICHMOND -
MAJORITY"]])
ContraCostadflist[["MEASURE P - CITY OF RICHMOND -\nMAJORITY"]]
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["MEASURE P - CITY OF RICHMOND -
MAJORITY"]])
ContraCostadflist[["CONTROLLER"]]
ContraCostadflist[["MEASURE P - CITY OF RICHMOND -
MAJORITY"]]
combinedContraCosta=combinesheets(ContraCostaFilePath)
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
###############################################################################################################################
View(ContraCostadflist)
View(ContraCostadflist[["MEASURE P - CITY OF RICHMOND"]])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
#transform to CSV
ContraCostacsvoutput=transform_to_csv(ContraCostadflist,'Precinct')
###############################################################################################################################
View(ContraCostacsvoutput)
###############################################################################################################################
View(ContraCostacsvoutput[1])
(ContraCostacsvoutput[2,1])
(ContraCostacsvoutput[1,2])
(ContraCostacsvoutput[1,2])+2
(ContraCostacsvoutput[1])+(ContraCostacsvoutput[1])
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
#transform to CSV
ContraCostacsvoutput=transform_to_csv(ContraCostadflist,'Precinct')
#export CSV
exportcsv(ContraCostacsvoutput,'Contra Costa County Organized.csv')
ContraCostadflist=combinedContraCosta
ContraCostadflist=rename_dataframes_headers(ContraCostadflist,1,1,3)
ContraCostadflist=select_dcr(ContraCostadflist,c(2,3,4,5,6,7,10,121),c(5,6,8),seq(10,6330,5))
View(ContraCostadflist)
View(ContraCostadflist[["CONTROLLER"]])
#rename dataframes and headers
for(i in seq(length(ContraCostadflist))){
#loop through every column in each dataframe and change the column headers from row header_row
for(j in seq(2,ncol(ContraCostadflist[[i]]))){
colnames(ContraCostadflist[[i]])[j] = paste(names(ContraCostadflist[i]),colnames(ContraCostadflist[[i]])[j])
}
}
#transform to CSV
ContraCostacsvoutput=transform_to_csv(ContraCostadflist,'Precinct')
View(ContraCostacsvoutput)
#transform to CSV
ContraCostacsvoutput=transform_to_csv(ContraCostadflist,'Precinct')
#export CSV
exportcsv(ContraCostacsvoutput,'Contra Costa County Organized.csv')
combinedFresno=combinesheets(FresnoFilePath)
Fresnodflist=combinedFresno
View(Fresnodflist)
View(Fresnodflist[["Table 1"]])
Fresnodflist=natozero(Fresnodflist)
View(Fresnodflist[["Table 1"]])
library(caTools)
#import libraries
library(readxl)
library(tidyverse)
library(stringr)
library(caTools)
library(ggplot2)
library(magrittr)
library(dplyr)
ExperimentPath="/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/ExperimentWithPropositions.xlsx"
#combines multipage excel file into one list of dataframes
combinesheets=function(file){
sheets = readxl::excel_sheets(file)
tibble = lapply(sheets, function(x) readxl::read_excel(file, sheet = x))
data_frame = lapply(tibble, as.data.frame)
names(data_frame) = sheets
return(data_frame)
}
#turn every na to 0 and every **** to 0
natozero=function(dflist){
for(i in seq(length(dflist))){
dflist[[i]][is.na(dflist[[i]])] = 0
dflist[[i]][dflist[[i]]=="****"] = 0
}
return(dflist)
}
#transform dataframe list into a single CSV file
transform_to_csv=function(dflist,merge_column){
csv=Reduce(function(dtf1, dtf2) full_join(dtf1, dtf2, by = merge_column, all.x = TRUE),dflist)
}
#export csv to final output
exportcsv=function(csv,name){
file_name=paste('/Users/davidlitman/Library/CloudStorage/Dropbox/niskanen/output/Statements of Votes—Final CSV/',name,sep='')
write.csv(csv,file=file_name, row.names=FALSE,na='')
print(paste('exported as',file_name))
}
combinedExperiment=combinesheets(ExperimentPath)
Experimentdflist=combinedExperiment
#for each dataframe, filter only rows with total values and columns of precinct and vote counts
for(i in seq(length(Experimentdflist))){
Experimentdflist[[i]]=filter(Experimentdflist[[i]],`TYPE`=="TOTAL")
# Experimentdflist[[i]]=select(Experimentdflist[[i]],2,9,10)
}
#transform to CSV
Experimentcsv=transform_to_csv(Experimentdflist,'PRECINCT')
#select only contest candidates we want and order them Democratic-Republican
Experimentcsv=select(Experimentcsv,contains("precinct"),
contains("gavin newsom"),contains("brian dahle"),
contains("kounalakis"),contains("jacobs"),
contains("shirley n weber"),contains("rob bernosky"),
contains("malia m cohen"),contains("lanhee j chen"),
contains("fiona ma"),contains("jack m guerrero"),
contains("rob bonta"),contains("nathan hochman"),
contains("alex padilla"),contains("mark p meuser"),
contains("ula yes"),contains("ula no"),
contains("lh yes"),contains("lh no"),
contains("proposition 1 yes"), contains("proposition 1 no"),
contains("proposition 27 yes"), contains("proposition 27 no"),
contains("proposition 29 yes"), contains("proposition 29 no"),
contains("proposition 31 yes"), contains("proposition 31 no"),
contains("proposition 26 yes"), contains("proposition 26 no"),
contains("proposition 28 yes"), contains("proposition 28 no"),
)
DATA=Experimentcsv
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#get yvar (ratio of yes votes on a given measure)
DATA$yvar=(DATA[[yescolumn]]/(DATA[[yescolumn]]+DATA[[nocolumn]]))
#get xvar (average of ratio of democratic votes across contests). Numbers entered for index since all dataframes are identical
DATA$xvar=rowMeans(data.frame((DATA[2]/(DATA[2]+DATA[3])),(DATA[4]/(DATA[4]+DATA[5])),(DATA[6]/(DATA[6]+DATA[7])),(DATA[8]/(DATA[8]+DATA[9])),(DATA[10]/(DATA[10]+DATA[11])),(DATA[12]/(DATA[12]+DATA[13])),(DATA[14]/(DATA[14]+DATA[15]))))
#make regressor
lm.out=lm(yvar~xvar, data=DATA, weights = DATA[[yescolumn]]+DATA[[nocolumn]])
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") #
print(summary(lm.out))
?ggplot
?legend
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
main(measurefull)
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
main(measurefull)
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
main(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#get yvar (ratio of yes votes on a given measure)
DATA$yvar=(DATA[[yescolumn]]/(DATA[[yescolumn]]+DATA[[nocolumn]]))
#get xvar (average of ratio of democratic votes across contests). Numbers entered for index since all dataframes are identical
DATA$xvar=rowMeans(data.frame((DATA[2]/(DATA[2]+DATA[3])),(DATA[4]/(DATA[4]+DATA[5])),(DATA[6]/(DATA[6]+DATA[7])),(DATA[8]/(DATA[8]+DATA[9])),(DATA[10]/(DATA[10]+DATA[11])),(DATA[12]/(DATA[12]+DATA[13])),(DATA[14]/(DATA[14]+DATA[15]))))
#make regressor
lm.out=lm(yvar~xvar, data=DATA, weights = DATA[[yescolumn]]+DATA[[nocolumn]])
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab(paste("Support for Measure",measure,"(ratio of 'Yes' votes)"))
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab((paste("Support for Measure",measure,"(ratio of 'Yes' votes)")))
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab((paste("Support for Measure",measure,"(ratio of 'Yes' votes)")))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
#ylab((paste("Support for Measure",measure,"(ratio of 'Yes' votes)")))
)
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)")
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)")
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
#ggtitle(measurefull) +
sub("Alameda County Precinct by Precinct Scatterplot and Best Fit Line") +
xlab("Support for Democrats (avg. of ratio of Dem. votes in state contests)") +
ylab((paste("Support for Measure",measure,"(ratio of 'Yes' votes)")))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3")
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle("hi")
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measaurefull)
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measaurefull)
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#get yvar (ratio of yes votes on a given measure)
DATA$yvar=(DATA[[yescolumn]]/(DATA[[yescolumn]]+DATA[[nocolumn]]))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measaurefull)
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull)
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull) +
xlab("Democraticness") +
ylab(paste("Support for measure",measure))
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull,subtitle="Precinct Scatterplot in LA County") +
xlab("Democraticness of Precinct") +
ylab(paste("Support for ",measure))
DATA=Experimentcsv
View(DATA)
?grep
grep(127710,DATA[,1])
DATA[,1]
grep(90075,DATA[,1])
grep(127710,DATA[,1])
grep(1277,DATA[,1])
grep(12771,DATA[,1])
grepl(1277,DATA[,1])
9003077A
grep(9003077,DATA[,1])
grep(9003077A,DATA[,1])
grep("9003077A",DATA[,1])
grep("900",DATA[,1])
grep("9003",DATA[,1])
UCLADATA=slice(DATA,seq(791,858))
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
DATA=Experimentcsv
DATA=slice(DATA,seq(791,858))
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#get yvar (ratio of yes votes on a given measure)
DATA$yvar=(DATA[[yescolumn]]/(DATA[[yescolumn]]+DATA[[nocolumn]]))
#get xvar (average of ratio of democratic votes across contests). Numbers entered for index since all dataframes are identical
DATA$xvar=rowMeans(data.frame((DATA[2]/(DATA[2]+DATA[3])),(DATA[4]/(DATA[4]+DATA[5])),(DATA[6]/(DATA[6]+DATA[7])),(DATA[8]/(DATA[8]+DATA[9])),(DATA[10]/(DATA[10]+DATA[11])),(DATA[12]/(DATA[12]+DATA[13])),(DATA[14]/(DATA[14]+DATA[15]))))
#make regressor
lm.out=lm(yvar~xvar, data=DATA, weights = DATA[[yescolumn]]+DATA[[nocolumn]])
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull,subtitle="Precinct Scatterplot in LA County") +
xlab("Democraticness of Precinct") +
ylab(paste("Support for ",measure))
DATA=Experimentcsv
measurefull="California Proposition 31\n Uphold Ban on Flavored Tobacco Products"
measure="Prop 31"
yescolumn="PROPOSITION 31 YES"
nocolumn="PROPOSITION 31 NO"
#get yvar (ratio of yes votes on a given measure)
DATA$yvar=(DATA[[yescolumn]]/(DATA[[yescolumn]]+DATA[[nocolumn]]))
#get xvar (average of ratio of democratic votes across contests). Numbers entered for index since all dataframes are identical
DATA$xvar=rowMeans(data.frame((DATA[2]/(DATA[2]+DATA[3])),(DATA[4]/(DATA[4]+DATA[5])),(DATA[6]/(DATA[6]+DATA[7])),(DATA[8]/(DATA[8]+DATA[9])),(DATA[10]/(DATA[10]+DATA[11])),(DATA[12]/(DATA[12]+DATA[13])),(DATA[14]/(DATA[14]+DATA[15]))))
#make regressor
lm.out=lm(yvar~xvar, data=DATA, weights = DATA[[yescolumn]]+DATA[[nocolumn]])
#try some heatmap stuff
library(ggplot2)
library(dplyr)
DATA$zvar = DATA[[yescolumn]]+DATA[[nocolumn]]
ggplot(DATA, aes(x=xvar, y=yvar, size=zvar)) +  geom_point(alpha=0.7, color='darkgreen') +
scale_size(range = c(0.05, 4)) +
geom_abline(slope=lm.out[[1]][2], intercept = lm.out[[1]][1], color = "springgreen3") +
ggtitle(measurefull,subtitle="Precinct Scatterplot in LA County") +
xlab("Democraticness of Precinct") +
ylab(paste("Support for ",measure))
